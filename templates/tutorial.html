{% extends "base.html" %}

{% block title %}Tutorial - Meet Tokky!{% endblock %}

{% block extra_head %}
<style>
.tutorial-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}

.tokky-welcome {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 20px;
    text-align: center;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.tokky-avatar {
    width: 120px;
    height: 120px;
    background: white;
    border-radius: 50%;
    margin: 0 auto 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: bounce 2s infinite;
    padding: 20px;
    box-sizing: border-box;
}

.tokky-avatar img {
    width: 100%;
    height: 100%;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}

.tutorial-step {
    background: var(--card-bg);
    border: var(--card-border);
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--card-shadow);
    display: none;
    animation: fadeInStep 0.5s ease;
}

.tutorial-step.active {
    display: block;
    border-left: 5px solid #4CAF50;
}

@keyframes fadeInStep {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.step-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.step-number {
    background: #4CAF50;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
}

.step-number.completed {
    background: #2E7D32;
}

.tokky-bubble {
    background: #e3f2fd;
    border: 2px solid #2196F3;
    border-radius: 20px;
    padding: 1.5rem;
    margin: 1rem 0;
    position: relative;
    animation: fadeIn 0.5s ease;
}

.tokky-bubble::before {
    content: '';
    position: absolute;
    left: -15px;
    top: -10px;
    background: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #2196F3;
    background-image: url('{{ url_for("static", filename="favicon.svg") }}');
    background-size: 20px 20px;
    background-repeat: no-repeat;
    background-position: center;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.demo-game {
    background: var(--card-bg);
    border: 2px dashed #4CAF50;
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    margin: 1rem 0;
}

.demo-target {
    font-size: 2rem;
    font-weight: bold;
    color: #4CAF50;
    margin-bottom: 0.5rem;
}

.demo-token {
    color: #666;
    font-size: 1.2rem;
    margin-bottom: 1rem;
}

.demo-input {
    display: flex;
    gap: 1rem;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
}

.demo-input input {
    padding: 0.8rem;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 1.1rem;
    min-width: 200px;
}

.demo-input input:focus {
    border-color: #4CAF50;
    outline: none;
}

.tutorial-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
    flex-wrap: wrap;
}

.big-nav-buttons {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 1rem;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    padding: 1rem 2rem;
    border-radius: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
}

.big-nav-buttons .btn {
    font-size: 1.2rem;
    padding: 1rem 2rem;
    min-width: 120px;
}

.btn {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background: #45a049;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #f0f0f0;
    color: #333;
}

.btn-secondary:hover {
    background: #e0e0e0;
    transform: translateY(-2px);
}

.token-visualization {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin: 1rem 0;
    flex-wrap: wrap;
}

.token-box {
    background: #e8f5e8;
    border: 2px solid #4CAF50;
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
    min-width: 120px;
}

.token-distance {
    background: #fff3e0;
    border: 2px solid #FF9800;
    border-radius: 15px;
    padding: 1rem;
    text-align: center;
    font-weight: bold;
    color: #F57C00;
}

.progress-bar {
    background: #f0f0f0;
    border-radius: 10px;
    height: 8px;
    margin-top: 2rem;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, #4CAF50, #45a049);
    height: 100%;
    border-radius: 10px;
    transition: width 0.5s ease;
    width: 0%;
}

.hidden {
    display: none;
}

@media (max-width: 768px) {
    .tutorial-container {
        padding: 1rem;
    }
    
    .demo-input {
        flex-direction: column;
    }
    
    .demo-input input {
        min-width: auto;
        width: 100%;
    }
    
    .tutorial-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 250px;
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="tutorial-container">
    <!-- Welcome Section -->
    <div class="tokky-welcome">
                    <div class="tokky-avatar">
                <img src="{{ url_for('static', filename='favicon.svg') }}" alt="Tokky the Robot Guide">
            </div>
        <h1>Hi! I'm Tokky! üëã</h1>
        <p>I'm your AI guide here to help you master Token Quest! Get ready to discover the amazing world of tokens while having tons of fun!</p>
    </div>

    <!-- Tutorial Steps -->
    <div class="tutorial-steps">
        <!-- Step 1: Introduction -->
        <div class="tutorial-step active" id="step-1">
            <div class="step-header">
                <div class="step-number">1</div>
                <h2>Welcome to Token Quest!</h2>
            </div>
            
            <div class="tokky-bubble">
                "Token Quest is like a detective game for words! You'll see a target word, and your job is to find other words that are similar to it. But here's the mystery - every word has a special number called a 'token ID'! Think of it like each word having its own secret code! üéØ"
            </div>
            
            <p>The big question we're trying to solve: <strong>Do words with similar meanings actually have token IDs that are close together?</strong> That's what we're here to discover! Nobody knows for sure - that's the whole point of our research!</p>
            
            <div class="demo-game">
                <div class="demo-target">Example: HAPPY</div>
                <div class="demo-token">Token ID: {{ tutorial_examples.happy if tutorial_examples.happy else 'Multi-token word!' }}</div>
                <p>Your goal: Find words that mean something similar to "HAPPY"!</p>
            </div>
        </div>

        <!-- Step 2: How Token IDs Work -->
        <div class="tutorial-step" id="step-2">
            <div class="step-header">
                <div class="step-number">2</div>
                <h2>What are Token IDs?</h2>
            </div>
            
            <div class="tokky-bubble">
                "Imagine if every word had a house number on a really long street! Token IDs are like those house numbers. Our hypothesis is that words that live close to each other (with similar numbers) might be related! But we need to test this theory! üè†"
            </div>
            
            <div class="token-visualization">
                <div class="token-box">
                    <strong>HAPPY</strong><br>
                    Token: {{ tutorial_examples.happy if tutorial_examples.happy else 'Multi-token' }}
                </div>
                <div class="token-distance">
                    Distance: {% if happy_joyful_distance %}{{ happy_joyful_distance }}{% else %}?{% endif %}
                </div>
                <div class="token-box">
                    <strong>JOYFUL</strong><br>
                    Token: {{ tutorial_examples.joyful if tutorial_examples.joyful else 'Multi-token' }}
                </div>
            </div>
            
            <p><strong>The big question:</strong> ARE words with similar meanings actually close together in token space? Or is it just random? 
            {% if happy_joyful_distance %}
                <em>Interestingly, "happy" and "joyful" are {{ happy_joyful_distance }} tokens apart - is that close or far? Let's find out what this means!</em>
            {% else %}
                That's what we're going to find out by playing!
            {% endif %}
            </p>
        </div>

        <!-- Step 3: Making Your First Guess -->
        <div class="tutorial-step" id="step-3">
            <div class="step-header">
                <div class="step-number">3</div>
                <h2>Let's Make a Guess!</h2>
            </div>
            
            <div class="tokky-bubble">
                "Now for the fun part! Let's practice with a real example. I'll show you a target word, and you can type in a word that you think is similar. Don't worry about being perfect - this is just practice to see how it works! üéÆ"
            </div>
            
            <div class="demo-game">
                <div class="demo-target">TARGET: BRIGHT</div>
                <div class="demo-token">Token ID: {{ tutorial_examples.bright if tutorial_examples.bright else 'Multi-token word!' }}</div>
                
                <div class="demo-input">
                    <input type="text" id="practice-input" placeholder="Type a similar word..." maxlength="20">
                    <button class="btn btn-primary" onclick="makePracticeGuess()">Submit Guess</button>
                </div>
                
                <div id="practice-result" class="hidden">
                    <!-- Result will appear here -->
                </div>
            </div>
            
            <div class="tokky-bubble hidden" id="practice-hint">
                "Think of words that describe something that shines or glows! Words like 'shiny', 'brilliant', 'glowing', or 'luminous' might be interesting to test! ‚ú®"
            </div>
        </div>

        <!-- Step 4: Scoring System -->
        <div class="tutorial-step" id="step-4">
            <div class="step-header">
                <div class="step-number">4</div>
                <h2>How Scoring Works</h2>
            </div>
            
            <div class="tokky-bubble">
                "Here's how we measure success in our research! The closer your word's token ID is to the target word's token ID, the more points you get! But there's more to it - let me explain the complete scoring system! üèÜ"
            </div>
            
            <div style="background: #e8f5e8; border: 2px solid #4CAF50; border-radius: 15px; padding: 1.5rem; margin: 1rem 0;">
                <h4>üéØ Distance-Based Scoring (Normal Mode)</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #4CAF50;">
                        <strong>üéâ Perfect Match!</strong><br>
                        Distance: 0-1<br>
                        <span style="color: #4CAF50; font-size: 1.2em;">10 Points!</span><br>
                        <small>"üéØ YOU GOT IT!"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #4CAF50;">
                        <strong>üëç Excellent!</strong><br>
                        Distance: 2-100<br>
                        <span style="color: #4CAF50; font-size: 1.2em;">9 Points!</span><br>
                        <small>"Great synonym sense!"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #8BC34A;">
                        <strong>üòä Very Good!</strong><br>
                        Distance: 101-500<br>
                        <span style="color: #8BC34A; font-size: 1.2em;">8 Points!</span><br>
                        <small>"Getting warmer..."</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #CDDC39;">
                        <strong>üëå Good!</strong><br>
                        Distance: 501-1000<br>
                        <span style="color: #CDDC39; font-size: 1.2em;">7 Points!</span><br>
                        <small>"On the right track"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #FF9800;">
                        <strong>üòê Okay</strong><br>
                        Distance: 1001-5000<br>
                        <span style="color: #FF9800; font-size: 1.2em;">6 Points!</span><br>
                        <small>"Getting colder..."</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #FF5722;">
                        <strong>üò¨ Not Great</strong><br>
                        Distance: 5001-10000<br>
                        <span style="color: #FF5722; font-size: 1.2em;">5 Points!</span><br>
                        <small>"Try different words"</small>
                    </div>
                </div>
            </div>

            <div style="background: #fce4ec; border: 2px solid #E91E63; border-radius: 15px; padding: 1.5rem; margin: 1rem 0;">
                <h4>‚ö° Antonym Mode Scoring</h4>
                <p><strong>In Antonym Mode, everything is reversed!</strong> The farther apart the words are, the better!</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #E91E63;">
                        <strong>üéØ Perfect Opposite!</strong><br>
                        Distance: 50000+<br>
                        <span style="color: #E91E63; font-size: 1.2em;">10 Points!</span><br>
                        <small>"Maximum distance!"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #E91E63;">
                        <strong>üëç Great Antonym!</strong><br>
                        Distance: 30000+<br>
                        <span style="color: #E91E63; font-size: 1.2em;">9 Points!</span><br>
                        <small>"Very opposite!"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #F06292;">
                        <strong>üòä Good Opposite!</strong><br>
                        Distance: 20000+<br>
                        <span style="color: #F06292; font-size: 1.2em;">8 Points!</span><br>
                        <small>"Getting more opposite"</small>
                    </div>
                </div>
            </div>

            <div style="background: #e3f2fd; border: 2px solid #2196F3; border-radius: 15px; padding: 1.5rem; margin: 1rem 0;">
                <h4>‚úÖ Participation Points System</h4>
                <p><strong>New Feature!</strong> Even if your word isn't a single token, you can still earn points!</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #4CAF50;">
                        <strong>üéØ Single-Token Words</strong><br>
                        <span style="color: #4CAF50;">Full Distance-Based Scoring</span><br>
                        <small>0-10 points based on distance</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #2196F3;">
                        <strong>‚úÖ Valid Vocabulary Words</strong><br>
                        <span style="color: #2196F3;">10 Participation Points!</span><br>
                        <small>"Valid word! Try single-token words for better scoring!"</small>
                    </div>
                    <div style="background: white; padding: 1rem; border-radius: 10px; text-align: center; border: 2px solid #FF5722;">
                        <strong>‚ùå Invalid Words</strong><br>
                        <span style="color: #FF5722;">0 Points</span><br>
                        <small>Not in vocabulary or not a single token</small>
                    </div>
                </div>
            </div>

            <div class="tokky-bubble">
                "Remember: Your <strong>total score</strong> is the sum of all your round scores! We also track your <strong>accuracy</strong> - how many guesses were considered 'correct' (close enough to the target). At the end, you'll get a performance rating based on your accuracy! üìä"
            </div>
        </div>

        <!-- Step 5: Game Modes -->
        <div class="tutorial-step" id="step-5">
            <div class="step-header">
                <div class="step-number">5</div>
                <h2>Different Game Modes</h2>
            </div>
            
            <div class="tokky-bubble">
                "Token Quest has three exciting game modes! Each one tests our hypothesis in a different way, helping us discover how words and tokens might work together! üé™"
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0;">
                <div style="background: #e3f2fd; border: 2px solid #2196F3; border-radius: 15px; padding: 1.5rem; text-align: center;">
                    <h3>ü§ù Synonym Hunt</h3>
                    <p>Find words with similar meanings! Test if related words actually cluster together in token space.</p>
                </div>
                
                <div style="background: #fce4ec; border: 2px solid #E91E63; border-radius: 15px; padding: 1.5rem; text-align: center;">
                    <h3>‚ö° Antonym Challenge</h3>
                    <p>Find opposites! Research whether words with opposite meanings are really positioned far apart in token space.</p>
                </div>
                
                <div style="background: #f3e5f5; border: 2px solid #9C27B0; border-radius: 15px; padding: 1.5rem; text-align: center;">
                    <h3>üèÉ Speed Mode</h3>
                    <p>Race against time! Test your intuition about word relationships under pressure.</p>
                </div>
            </div>
        </div>

        <!-- Step 6: Scoring Strategy -->
        <div class="tutorial-step" id="step-6">
            <div class="step-header">
                <div class="step-number">6</div>
                <h2>Scoring Strategy Guide</h2>
            </div>
            
            <div class="tokky-bubble">
                "Now that you understand how scoring works, let me share some strategic tips to maximize your points and become a Token Quest champion! üèÜ‚ú®"
            </div>
            
            <div style="background: #e8f5e8; border: 2px solid #4CAF50; border-radius: 15px; padding: 1.5rem; margin: 1rem 0;">
                <h4>üéØ High-Scoring Strategies</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; border-left: 4px solid #4CAF50; padding: 1rem; border-radius: 10px;">
                        <h5>üí° Synonym Priority</h5>
                        <p><strong>Goal:</strong> 9-10 points per round</p>
                        <p>Target words like "happy" ‚Üí Try "glad", "joyful", "cheerful"</p>
                        <small>üí∞ Best chance for high scores!</small>
                    </div>
                    
                    <div style="background: white; border-left: 4px solid #2196F3; padding: 1rem; border-radius: 10px;">
                        <h5>üî§ Single-Token Focus</h5>
                        <p><strong>Goal:</strong> Maximum scoring potential</p>
                        <p>Stick to simple, common words that are likely single tokens</p>
                        <small>üí∞ Avoids the 10-point participation cap!</small>
                    </div>
                    
                    <div style="background: white; border-left: 4px solid #FF9800; padding: 1rem; border-radius: 10px;">
                        <h5>üé® Word Category Thinking</h5>
                        <p><strong>Goal:</strong> 6-8 points per round</p>
                        <p>If target is "red" ‚Üí Try other colors: "blue", "green"</p>
                        <small>üí∞ Related concepts often cluster together!</small>
                    </div>
                    
                    <div style="background: white; border-left: 4px solid #9C27B0; padding: 1rem; border-radius: 10px;">
                        <h5>‚ö° Antonym Mode Switch</h5>
                        <p><strong>Goal:</strong> 8-10 points in antonym mode</p>
                        <p>Target "hot" ‚Üí Try "cold", "freezing", "icy"</p>
                        <small>üí∞ Completely different scoring strategy!</small>
                    </div>
                </div>
            </div>

            <div style="background: #fff3e0; border: 2px solid #FF9800; border-radius: 15px; padding: 1.5rem; margin: 1rem 0;">
                <h4>üìä Score Accumulation Tips</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 10px; border: 2px solid #FFA000;">
                        <h5>üéØ Consistency Over Perfection</h5>
                        <p>Getting <strong>7-8 points consistently</strong> beats occasional 10s with mostly 0s!</p>
                        <p><em>Example: 10 rounds √ó 7 points = 70 total vs 2√ó10 + 8√ó0 = 20 total</em></p>
                    </div>
                    
                    <div style="background: white; padding: 1rem; border-radius: 10px; border: 2px solid #FFA000;">
                        <h5>üìà Accuracy Matters Too!</h5>
                        <p>Your <strong>performance rating</strong> depends on accuracy, not just total score!</p>
                        <p>80%+ accuracy = "Outstanding!" üèÜ<br>60%+ accuracy = "Great Job!" ü•á</p>
                    </div>
                </div>
            </div>

            <div class="tokky-bubble">
                "Pro tip: Don't worry if you don't know the 'perfect' answer! Every guess teaches us something about token relationships. The real goal is discovering patterns, not getting perfect scores! üî¨"
            </div>
        </div>

        <!-- Step 7: Pro Tips and Tricks -->
        <div class="tutorial-step" id="step-7">
            <div class="step-header">
                <div class="step-number">7</div>
                <h2>Pro Tips from Tokky!</h2>
            </div>
            
            <div class="tokky-bubble">
                "Here are my favorite advanced strategies to become a Token Quest researcher! These tips will help you make better guesses and discover patterns in how computers process language! üß†‚ú®"
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 1rem 0;">
                <div style="background: #e8f5e8; border-left: 4px solid #4CAF50; padding: 1rem; border-radius: 10px;">
                    <h4>üí° Think Synonyms First</h4>
                    <p>Start with words that mean the same thing. Do "big" and "large" really have close token IDs? Let's find out!</p>
                </div>
                
                <div style="background: #fff3e0; border-left: 4px solid #FF9800; padding: 1rem; border-radius: 10px;">
                    <h4>üîç Use the Hint System</h4>
                    <p>Stuck? Click the hint button! I'll give you semantic hints, token space hints, and fun facts!</p>
                </div>
                
                <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 1rem; border-radius: 10px;">
                    <h4>üéØ Try Different Word Forms</h4>
                    <p>Sometimes "running", "runs", and "run" have different token IDs. Experiment!</p>
                </div>
                
                <div style="background: #f3e5f5; border-left: 4px solid #9C27B0; padding: 1rem; border-radius: 10px;">
                    <h4>üåü Learn from Every Guess</h4>
                    <p>There are no "wrong" guesses - only data points! Pay attention to the distances and patterns to help solve the mystery.</p>
                </div>
            </div>
        </div>

        <!-- Step 8: Ready to Play -->
        <div class="tutorial-step" id="step-8">
            <div class="step-header">
                <div class="step-number">8</div>
                <h2>You're Ready to Play!</h2>
            </div>
            
            <div class="tokky-bubble">
                "Congratulations! You're now ready to become a Token Quest researcher! Remember, every guess helps us discover something new about how language works in the digital world. Let's solve this mystery together! üéâüöÄ"
            </div>
            
            <div class="tutorial-buttons">
                <a href="{{ url_for('game_setup', mode='synonym') }}" class="btn btn-primary">
                    ü§ù Start Synonym Hunt
                </a>
                <a href="{{ url_for('game_setup', mode='antonym') }}" class="btn btn-primary">
                    ‚ö° Try Antonym Challenge
                </a>
                <a href="{{ url_for('home') }}" class="btn btn-secondary">
                    üè† Back to Home
                </a>
            </div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>
</div>

<!-- Big Floating Navigation Buttons -->
<div class="big-nav-buttons">
    <button class="btn btn-secondary" id="prev-btn" onclick="previousStep()" disabled>
        ‚Üê Previous
    </button>
    <button class="btn btn-primary" id="next-btn" onclick="nextStep()">
        Next ‚Üí
    </button>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
let currentStep = 1;
const totalSteps = 8;

function updateProgress() {
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
}

function updateButtons() {
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    
    prevBtn.disabled = currentStep === 1;
    
    if (currentStep === totalSteps) {
        nextBtn.textContent = "Start Playing! üéÆ";
        nextBtn.onclick = () => window.location.href = "{{ url_for('home') }}";
    } else {
        nextBtn.textContent = "Next ‚Üí";
        nextBtn.onclick = nextStep;
    }
}

function showStep(stepNumber) {
    // Hide all steps and show only the current one
    for (let i = 1; i <= totalSteps; i++) {
        const step = document.getElementById(`step-${i}`);
        step.classList.remove('active');
        
        if (i === stepNumber) {
            step.classList.add('active');
            // Update step number display
            const stepNum = step.querySelector('.step-number');
            if (i < currentStep) {
                stepNum.classList.add('completed');
                stepNum.textContent = '‚úì';
            } else {
                stepNum.classList.remove('completed');
                stepNum.textContent = i;
            }
        }
    }
    
    updateProgress();
    updateButtons();
    
    // Scroll to top of the tutorial container
    document.querySelector('.tutorial-container').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

function nextStep() {
    if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
    }
}

function previousStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
    }
}

function makePracticeGuess() {
    const input = document.getElementById('practice-input');
    const guess = input.value.toLowerCase().trim();
    const resultDiv = document.getElementById('practice-result');
    const hintDiv = document.getElementById('practice-hint');
    
    if (!guess) {
        alert("Please enter a word first!");
        return;
    }
    
    // Show loading state
    resultDiv.innerHTML = `
        <div style="background: #f0f0f0; border: 2px solid #ccc; border-radius: 15px; padding: 1.5rem; margin-top: 1rem; text-align: center;">
            <h3>Analyzing "${guess.toUpperCase()}" with real tiktoken...</h3>
            <p>ü§ñ Computing actual token IDs and distances...</p>
        </div>
    `;
    resultDiv.classList.remove('hidden');
    
    // Make real API call
    fetch('/api/tutorial_guess', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            guess: guess,
            target: 'bright'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show real result
            resultDiv.innerHTML = `
                <div style="background: #e8f5e8; border: 2px solid #4CAF50; border-radius: 15px; padding: 1.5rem; margin-top: 1rem; text-align: center;">
                    <h3>REAL Result for "${data.guess_word.toUpperCase()}"</h3>
                    <div class="token-visualization">
                        <div class="token-box">
                            <strong>BRIGHT</strong><br>
                            Token: ${data.target_token_id}
                        </div>
                        <div class="token-distance">Distance: ${data.distance}</div>
                        <div class="token-box">
                            <strong>${data.guess_word.toUpperCase()}</strong><br>
                            Token: ${data.guess_token_id}
                        </div>
                    </div>
                    <div style="background: #4CAF50; color: white; padding: 1rem; border-radius: 10px; margin-top: 1rem;">
                        <strong>+${data.points} Points!</strong><br>
                        ${data.is_exact_match ? "Perfect match!" : "Real distance calculated!"}
                    </div>
                    <div style="background: #e3f2fd; border: 2px solid #2196F3; border-radius: 10px; padding: 1rem; margin-top: 1rem;">
                        <strong>üß† Real Analysis:</strong><br>
                        ${data.explanation}
                    </div>
                </div>
            `;
            
            // Show hint if it's a less optimal guess
            if (data.points < 70) {
                hintDiv.classList.remove('hidden');
            }
            
            // Add some encouraging Tokky dialogue
            setTimeout(() => {
                const encouragement = document.createElement('div');
                encouragement.className = 'tokky-bubble';
                encouragement.innerHTML = `"${getTokkyEncouragement(data.points)}"`;
                resultDiv.appendChild(encouragement);
            }, 1000);
        } else {
            // Show error
            resultDiv.innerHTML = `
                <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 15px; padding: 1.5rem; margin-top: 1rem; text-align: center;">
                    <h3>Oops!</h3>
                    <p>${data.error}</p>
                    <p><em>Try a different word - some words might be split into multiple tokens!</em></p>
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultDiv.innerHTML = `
            <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 15px; padding: 1.5rem; margin-top: 1rem; text-align: center;">
                <h3>Network Error</h3>
                <p>Could not connect to analyze the word. Please try again!</p>
            </div>
        `;
    });
    
    // Clear input
    input.value = '';
}

function getTokkyEncouragement(points) {
    if (points >= 90) {
        return "WOW! That's fascinating data! You found a word that's really close in token space! üåü";
    } else if (points >= 70) {
        return "Interesting! That word seems to have a pretty close token ID. This is valuable research data! üëè";
    } else if (points >= 50) {
        return "Good observation! Every guess helps us understand the relationship between meaning and tokens! üéØ";
    } else {
        return "Fascinating! Even distant guesses give us important clues about how tokens are organized! This is all valuable research! üí™";
    }
}

// Initialize tutorial
document.addEventListener('DOMContentLoaded', function() {
    updateProgress();
    updateButtons();
    
    // Add enter key support for practice input
    document.getElementById('practice-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            makePracticeGuess();
        }
    });
});
</script>
{% endblock %} 